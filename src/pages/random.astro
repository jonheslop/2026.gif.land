---
export const prerender = false;
import { turso, type Fave } from "../turso";

const { env } = Astro.locals.runtime;

const { rows } = await turso({
  url: env.TURSO_DATABASE_URL,
  authToken: env.TURSO_AUTH_TOKEN,
}).execute(
  `SELECT * FROM favourites WHERE published = true ORDER BY RANDOM() LIMIT 1`,
);

const fave = rows[0] as Fave;

if (!fave) {
  return new Response(null, {
    status: 404,
    statusText: "Not found",
  });
}

return Astro.redirect(`/info/${fave.url}`);
---
