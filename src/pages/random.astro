---
export const prerender = false;
import { turso, type Fave } from "../turso";

const { rows } = await turso({
  url: import.meta.env.TURSO_DATABASE_URL ?? process.env.TURSO_DATABASE_URL,
  authToken: import.meta.env.TURSO_AUTH_TOKEN ?? process.env.TURSO_AUTH_TOKEN,
}).execute(
  `SELECT * FROM favourites WHERE published = true ORDER BY RANDOM() LIMIT 1`,
);

const fave = rows[0] as Fave;

if (!fave) {
  return new Response(null, {
    status: 404,
    statusText: "Not found",
  });
}

return Astro.redirect(`/info/${fave.url}`);
---
