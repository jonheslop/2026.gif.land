---
import { turso, type Fave } from "../../turso";
import Layout from "../../Layout.astro";
import CopyButton from "../../components/CopyButton.astro";

const { slug } = Astro.params;

export async function getStaticPaths() {
  const { rows } = await turso.execute(`SELECT * FROM favourites`);

  const faves = rows as Fave[];

  return faves.map((fave) => ({
    params: { slug: fave.url },
    props: { fave },
  }));
}

const { fave: item } = Astro.props;
---

<Layout>
  <div class="flex flex-col lg:grid grid-cols-4 gap-4 lg:gap-8 xl:mt-4">
    <img
      class="w-full lg:col-span-2"
      width={item.width}
      height={item.height}
      alt={item.url}
      src={`https://gif.land/${slug}`}
    />
    <article
      class="z-20 mix-blend-difference hover:mix-blend-normal hover:bg-white transition-colors p-4 -m-4 -mt-6 rounded-sm self-start lg:col-start-3"
    >
      <h1 class="leading-tight text-3xl break-all">
        <a target="_blank" href={`https://gif.land/${item.url}`}>
          {item.url}
        </a>
      </h1>
      <p class="text-neutral-500 dark:text-neutral-400 mt-1">
        Tags:{" "}
        {
          item.tags.split(",").map((tag, index) => (
            <a href={`/search/${encodeURI(tag)}`} class="hover:underline">
              {tag}
              {index < item.tags.split(",").length - 1 ? ", " : ""}
            </a>
          ))
        }
      </p>
      <CopyButton text={`https://gif.land/${slug}`} />
    </article>
  </div>
</Layout>
